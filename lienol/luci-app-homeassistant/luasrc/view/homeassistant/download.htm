<%#
 Copyright 2018 <lienol@qq.com>
 Licensed to the public under the Apache License 2.0.
-%>

<%
local dsp = require "luci.dispatcher"
-%>

<script type="text/javascript">//<![CDATA[
	function downloadClick(btn)
	{
		btn.disabled = true;
		btn.value = '<%:Update...%>';
		XHR.get('<%=dsp.build_url("admin/services/homeassistant/download")%>',null,
			function(x,data)
			{
				if (x && x.status == 200) {
					window.location.href='<%=dsp.build_url("admin/services/homeassistant/log")%>';
				}
				else {
					alert("<%:Error%>");
					btn.disabled = false;
					btn.value = '<%:Manually update%>';
				}
			}
		);
		return false;
	}
//]]></script>

<%+cbi/valueheader%>
	<% if self:cfgvalue(section) ~= false then %>
		<input class="cbi-button cbi-input-<%=self.inputstyle or "button" %>" type="button"<%=
			attr("name", cbid) ..
			attr("id", self.id or cbid) ..
			attr("value", self.inputtitle or self.title) ..
			ifattr(self.btnclick, "onclick", self.btnclick) ..
			ifattr(self.placeholder, "placeholder")
		%> />
		<span id="<%=self.id or cbid%>-detail"></span>
	<% else %>
		-
	<% end %>
<%+cbi/valuefooter%>