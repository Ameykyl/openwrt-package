<%#
 Copyright 2018 Lienol <lienol@qq.com>
 Licensed to the public under the Apache License 2.0.
-%>

<%
local dsp = require "luci.dispatcher"
-%>

<script type="text/javascript">//<![CDATA[
	function clearlog(btn)
	{
		XHR.get('<%=dsp.build_url("admin/services/homeassistant/clear_log")%>',null,
			function(x,data)
			{
				if (x && x.status == 200) {
					var log_textarea = document.getElementById('log_textarea');
					log_textarea.innerHTML = "";
					log_textarea.scrollTop = log_textarea.scrollHeight;
				}
			}
		);
	}
	XHR.poll(3,'<%=dsp.build_url("admin/services/homeassistant/get_log")%>',null,
		function(x,data)
		{
			if (x && x.status == 200) {
				var log_textarea = document.getElementById('log_textarea');
				log_textarea.innerHTML = x.responseText;
				log_textarea.scrollTop = log_textarea.scrollHeight;
			}
		}
	);
//]]></script>
<fieldset class="cbi-section" id="_log_fieldset" >
	<legend>这里显示的是最近的日志。</legend>
	<input class="cbi-button cbi-input-apply" type="button" onclick="clearlog()" value="清空日志">
	<textarea id="log_textarea" class="cbi-input-textarea" style="width: 100%;margin-top: 10px;" data-update="change" rows="50" wrap="off" readonly="readonly"></textarea>
</fieldset>